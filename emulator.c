#include<stdio.h>
#include<stdint.h>
#include<sys/stat.h>

#define MEMORY_SIZE 4096

uint8_t V[16] = {0};
uint8_t memory[MEMORY_SIZE] = {0};
uint16_t I = 0;
uint16_t PC = 0x200;
uint8_t SP = 0;
uint16_t opcode = 0;
uint16_t stack[16] = {0};
uint8_t keypad[16] = {0};
uint8_t display[64 * 32] = {0};
uint8_t delay = 0;
uint8_t sound = 0;
const uint8_t fontset[80] = {
    0xF0, 0x90, 0x90, 0x90, 0xF0,  // 0
    0x20, 0x60, 0x20, 0x20, 0x70,  // 1
    0xF0, 0x10, 0xF0, 0x80, 0xF0,  // 2
    0xF0, 0x10, 0xF0, 0x10, 0xF0,  // 3
    0x90, 0x90, 0xF0, 0x10, 0x10,  // 4
    0xF0, 0x80, 0xF0, 0x10, 0xF0,  // 5
    0xF0, 0x80, 0xF0, 0x90, 0xF0,  // 6
    0xF0, 0x10, 0x20, 0x40, 0x40,  // 7
    0xF0, 0x90, 0xF0, 0x90, 0xF0,  // 8
    0xF0, 0x90, 0xF0, 0x10, 0xF0,  // 9
    0xF0, 0x90, 0xF0, 0x90, 0x90,  // A
    0xE0, 0x90, 0xE0, 0x90, 0xE0,  // B
    0xF0, 0x80, 0x80, 0x80, 0xF0,  // C
    0xE0, 0x90, 0x90, 0x90, 0xE0,  // D
    0xF0, 0x80, 0xF0, 0x80, 0xF0,  // E
    0xF0, 0x80, 0xF0, 0x80, 0x80   // F
};
uint8_t drawFlag = 0;
uint8_t soundFlag = 0;

void init_cpu() {
    memcpy(memory, fontset, sizeof(fontset));
}

int load_rom(char *filename) {
    FILE *fptr;
    if((fptr = fopen(filename, "rb")) == NULL) {
        printf("Error while loading rom file");
    }
    struct stat fileinfo;
    stat(filename, fptr);
    size_t bytes_read = fread(memory + 0x200, 1, sizeof(memory) - 0x200, fptr);
    fclose(fptr);
    if(bytes_read = fileinfo.st_size)
        return -1;
    return 0;
}